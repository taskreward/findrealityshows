<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reward Dashboard (70â‚¹ Test)</title>
  <style>
    body { margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f2f2f2; }
    .container { max-width: 500px; margin: auto; padding: 20px; }
    .wallet { background-color: #007bff; color: white; padding: 15px; border-radius: 10px; margin-bottom: 20px; text-align: center; }
    .section { background-color: white; padding: 15px; margin-bottom: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .task { display: flex; justify-content: space-between; align-items: center; margin: 10px 0; }
    .btn { padding: 5px 10px; background-color: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .btn[disabled] { background-color: #888; cursor: not-allowed; }
    .login-form { max-width: 400px; margin: 50px auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    .instructions { font-size: 14px; color: #555; margin-top: 5px; }
    .popup { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000; }
    .popup-content { background: white; padding: 25px; border-radius: 10px; max-width: 90%; text-align: center; }
    .popup-content p { margin-bottom: 10px; font-size: 15px; }
    .bank-input { width: 100%; padding: 8px; margin: 5px 0 10px; border: 1px solid #ccc; border-radius: 5px; }
  </style>
</head>
<body>

<div id="app"></div>
<div id="popupContainer"></div>

<script>
  const app = document.getElementById("app");
  const popupContainer = document.getElementById("popupContainer");
  const TASK_AMOUNT = 15;
  const WITHDRAW_LIMIT = 70;

  function renderLogin() {
    app.innerHTML = `
      <div class="login-form">
        <h2>Login or Register</h2>
        <input type="text" id="username" placeholder="Username" style="width: 100%; padding: 10px; margin-bottom: 10px;" />
        <input type="password" id="password" placeholder="Password" style="width: 100%; padding: 10px; margin-bottom: 10px;" />
        <button class="btn" style="width: 100%;" onclick="login()">Enter</button>
      </div>
    `;
  }

  function login() {
    const username = document.getElementById("username").value.trim();
    const password = document.getElementById("password").value.trim();

    if (!username || !password) return alert("Please enter both fields");

    const savedPass = localStorage.getItem(`pass_${username}`);
    if (savedPass && savedPass !== password) return alert("Wrong password");

    localStorage.setItem(`pass_${username}`, password);
    localStorage.setItem("current_user", username);
    if (!localStorage.getItem(`wallet_${username}`)) localStorage.setItem(`wallet_${username}`, 0);
    if (!localStorage.getItem(`taskLog_${username}`)) localStorage.setItem(`taskLog_${username}`, JSON.stringify([]));
    renderDashboard(username);
  }

  function addBalance(taskId) {
    const user = localStorage.getItem("current_user");
    const logKey = `taskLog_${user}`;
    const completedTasks = JSON.parse(localStorage.getItem(logKey) || "[]");

    if (completedTasks.includes(taskId)) return alert("You have already completed this task today.");
    completedTasks.push(taskId);
    localStorage.setItem(logKey, JSON.stringify(completedTasks));

    const walletKey = `wallet_${user}`;
    const current = parseInt(localStorage.getItem(walletKey) || 0);
    localStorage.setItem(walletKey, current + TASK_AMOUNT);
    renderDashboard(user);
  }

  function showWithdrawPopup() {
    const user = localStorage.getItem("current_user");
    const name = localStorage.getItem(`bank_name_${user}`) || "";
    const acc = localStorage.getItem(`bank_acc_${user}`) || "";
    const ifsc = localStorage.getItem(`bank_ifsc_${user}`) || "";

    popupContainer.innerHTML = `
      <div class="popup">
        <div class="popup-content">
          <h3>Withdrawal Instructions</h3>
          <p>To unlock your withdrawal, please deposit â‚¹399.</p>
          <p>Use the following UPI ID to pay:</p>
          <strong style="font-size: 16px;">sahilzeerak123@okhdfcbank</strong>
          <p>Once payment is done, contact support to confirm and release your reward.</p>
          <h4 style="margin-top: 15px;">Your Bank Details:</h4>
          <input class="bank-input" placeholder="Your Name" value="${name}" onchange="saveBank('name', this.value)" />
          <input class="bank-input" placeholder="Account Number" value="${acc}" onchange="saveBank('acc', this.value)" />
          <input class="bank-input" placeholder="IFSC Code" value="${ifsc}" onchange="saveBank('ifsc', this.value)" />
          <button class="btn" onclick="closePopup()">OK</button>
        </div>
      </div>
    `;
  }

  function saveBank(field, value) {
    const user = localStorage.getItem("current_user");
    localStorage.setItem(`bank_${field}_${user}`, value);
  }

  function closePopup() {
    popupContainer.innerHTML = "";
  }

  function withdrawRequest() {
    const user = localStorage.getItem("current_user");
    const amount = parseInt(localStorage.getItem(`wallet_${user}`) || 0);

    if (amount < WITHDRAW_LIMIT) {
      alert(`You need â‚¹${WITHDRAW_LIMIT} in wallet to unlock withdrawal.`);
      return;
    }

    showWithdrawPopup();
  }

  function renderDashboard(username) {
    const wallet = parseInt(localStorage.getItem(`wallet_${username}`) || 0);
    const withdrawEnabled = wallet >= WITHDRAW_LIMIT;
    app.innerHTML = `
      <div class="container">
        <div class="wallet">
          ðŸ‘‹ Welcome, <strong>${username}</strong><br>
          ðŸ’° Wallet: â‚¹${wallet}<br>
          <p style="font-size:13px; margin-top:5px;">Withdrawals available after â‚¹${WITHDRAW_LIMIT}.</p>
          <button class="btn" onclick="withdrawRequest()" ${!withdrawEnabled ? 'disabled' : ''}>Withdraw</button>
        </div>

        <div class="section">
          <h3>ðŸ“… Daily Tasks (â‚¹15 each)</h3>
          ${[1, 2, 3].map(i => `
            <div class="task">
              <div>
                âœ… Task ${i}<br>
                <div class="instructions">Complete offer ${i} via smart link.</div>
              </div>
              <button class="btn" onclick="addBalance('task${i}')">Mark â‚¹15</button>
            </div>
          `).join('')}
        </div>
      </div>
    `;
  }

  const user = localStorage.getItem("current_user");
  if (user) {
    renderDashboard(user);
  } else {
    renderLogin();
  }
</script>

</body>
</html>
